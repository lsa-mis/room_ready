<div class="container">
  <h1>Admin Dashboard - <%= show_date_with_month_name(@selected_date) %></h1>

    <%= form_with url: dashboard_path, method: :get,
      data: { 
        controller: "autosubmit", 
        autosubmit_target: "form"
      }  do |form| %>
      <div class="d-flex flex-row justify-content-start align-items-center gap-3">
        <div>
          <%= form.label :dashboard_date, "Change Date to Update Zone Overview" %>
        </div>
        <div>
          <%= form.date_field :dashboard_date, value: @selected_date, max: Date.today.to_s, :"data-action" => "change->autosubmit#submitForm" %>
        </div>
      </div>
    <% end %>


  <h2>Zone Overview</h2>
  <div class="row">    
    <% @zones.each do |zone| %>
      <div class="col-lg-4 col-md-6 col-sm-12 mb-3">
        <div class="card">
          <div class="card-header">
            <h3><%= zone.name %></h3>
           
          </div>
          <div class="card-body">
            <div class="progress mb-3">
              <div class="progress-bar <%= room_check_progress_class(rooms_checked_for_date(zone, @selected_date), total_rooms(zone)) %> text-white" role="progressbar" 
              style="width: <%= completion_percentage(rooms_checked_for_date(zone, @selected_date), total_rooms(zone)) %>%" 
              aria-valuenow="<%= completion_percentage(rooms_checked_for_date(zone, @selected_date), total_rooms(zone)) %>" 
              aria-valuemin="0" aria-valuemax="100">
              <%= completion_percentage(rooms_checked_for_date(zone, @selected_date), total_rooms(zone)) %>%
              </div>
            </div>

            <span class="card-text mb-4 <%= room_check_status_class(rooms_checked_for_date(zone, @selected_date), total_rooms(zone)) %>">
              <%= rooms_checked_for_date(zone, @selected_date) %>/<%= total_rooms(zone) %> 
              Classrooms Complete
            </span>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<hr>
  <h2>Reports for Last Checks</h2>
  <div class="row">
    <div class="col-md-6 col-lg-4 mb-3">
      <div class="card">
        <div class="card-header">
          <h4>Rooms were not Accessable</h4>
        </div>
        <div class="card-body">
          <%= pie_chart @room_access_data %>
        </div>
      </div>
    </div>

    <div class="col-md-6 col-lg-4 mb-3">
      <div class="card">
        <div class="card-header">
          <h4>Rooms were not Checked</h4>
        </div>
        <div class="card-body">
          <%= pie_chart @room_check_in_data %>
        </div>
    </div>
  </div>

  <hr>
  <h2>Recent Room Issues</h2>
  <div class="row">
    <% latest_room_tickets.each do |ticket| %>
      <div class="mb-3">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Room <%= ticket.room.room_number %> - <%= ticket.room.floor.building.name.titleize %></h5>
            <p class="card-text">Send to: <%= ticket.tdx_email %></p>
            <p class="card-text"><%= ticket.description %></p>
            <p class="card-text">Submitted on: <%= show_date_with_time(ticket.created_at) %> by: <%= ticket.submitted_by %></p>
          </div>
        </div>
      </div>
    <% end %>
  </div>
  <hr>
  <h2>Daily Resource Update Script</h2>
  <% if @room_update_log %>
    <%= render 'last_room_update_log', last_room_update_log: @room_update_log %>
  <% end %>
</div>
