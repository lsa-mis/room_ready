<p></p>
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1>Room States <%= @room.rmrecnbr? ? "for #{@room.room_number}" : '' %></h1>
  <div class="d-flex flex-column gap-1">
    <%= link_to "Back to Room", room_path(@room), class: "link_to" %>
  </div>
</div>
<h3>Location: <%= @room.floor.building.name %> (Floor <%= @room.floor.name %>) </h3>

<div id="room_states">
  <% if @room_states.empty? %>
    No room states found
  <% else %>
    <div class="accordion" id="accordionPanelsStayOpenExample">
      <% @room_states.sort_by { |room_state| room_state.updated_at }.reverse.each_with_index do |room_state, index| %>
      <div class="accordion-item">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapse<%= (index + 1) %>" aria-expanded="false" aria-controls="panelsStayOpen-collapseOne">
      <strong><%= show_date_with_time(room_state.updated_at) %>, Checked by <%= room_state.checked_by %>, 
      <span class="text-danger"><%= 'Issue Reported to Supervisor' if room_state.report_to_supervisor%></span>
      <span class="text-success"><%= 'No Issue Reported' if room_state.report_to_supervisor==false %></span>
      </strong>
      </button>
    <div id="panelsStayOpen-collapse<%= (index + 1) %>" class="accordion-collapse collapse">
      <div class="accordion-body">
        
        
        <% if room_state.is_accessed %>
          <div class="btn-group d-flex" role="group" aria-label="Basic radio toggle button group">
            <input type="radio" class="btn-check" name="btnradio" id="<%= (index + 1) %>common" autocomplete="off" data-bs-toggle="collapse" href="#common-answer-<%=(index + 1) %>" aria-expanded="false" aria-controls="common-answer-<%=(index + 1) %>">
            <label class="btn btn-outline-primary" for="<%= (index + 1) %>common">Common Questions</label>

            <input type="radio" class="btn-check" name="btnradio" id="<%= (index + 1) %>specific" autocomplete="off" data-bs-toggle="collapse" href="#spec-answer-<%=(index + 1) %>" aria-expanded="false" aria-controls="spec-answer-<%=(index + 1) %>">
            <label class="btn btn-outline-primary" for="<%= (index + 1) %>specific">Specific Questions</label>

            <input type="radio" class="btn-check" name="btnradio" id="<%= (index + 1) %>resource" autocomplete="off" data-bs-toggle="collapse" href="#res-answer-<%=(index + 1) %>" aria-expanded="false" aria-controls="res-answer-<%=(index + 1) %>">
            <label class="btn btn-outline-primary" for="<%= (index + 1) %>resource">Resources</label>
          </div>

              <div class="collapse multi-collapse" id="common-answer-<%=(index + 1) %>">
                  <h2>Common Questions</h2>
                  <table class="table text-center">
                    <thead class="table-group-divider">
                      <tr>
                        <th>Question</th>
                        <th>Response</th>
                      </tr>
                    </thead>
                    <tbody class="table-group-divider">
                    <% room_state.common_attribute_states.each_with_index do |common_attribute_state, index| %>
                      <tr class="rover_tbody_tr">
                        <td class="rover_tbody_td">
                          <%= common_attribute_state.common_attribute.description %>
                        </td>
                        <td class="rover_tbody_td">
                          <%= common_attribute_state.checkbox_value ? 'Yes' : 'No' %>
                        </td>
                      </tr>
                    <% end %>
                    </tbody>
                  </table>
              </div>


              <div class="collapse multi-collapse" id="spec-answer-<%=(index + 1) %>">
                  <h2>Specific Questions</h2>
                  <table class="table text-center">
                    <thead class="table-group-divider">
                      <tr>
                        <th>Question</th>
                        <th>Response</th>
                      </tr>
                    </thead>
                    <tbody class="table-group-divider">
                    <% room_state.specific_attribute_states.each_with_index do |specific_attribute_state, index| %>
                      <tr class="rover_tbody_tr">
                        <td class="rover_tbody_td">
                          <%= specific_attribute_state.specific_attribute.description %>
                        </td>
                        <td class="rover_tbody_td">
                          <%= specific_attribute_state.checkbox_value ? 'Yes' : 'No' %>
                        </td>
                      </tr>
                    <% end %>
                    </tbody>
                  </table>
              </div>


              <div class="collapse multi-collapse" id="res-answer-<%=(index + 1) %>">
                  <h2>Resources</h2>
                  <table class="table text-center">
                    <thead class="table-group-divider">
                      <tr>
                        <th>Item Name</th>
                        <th>Item Status</th>
                      </tr>
                    </thead>
                    <tbody class="table-group-divider">
                    <% @room.resources.each_with_index do |resource, index| %>
                      <tr class="rover_tbody_tr">
                        <td class="rover_tbody_td">
                          <%= resource.name %> - <%= resource.resource_type %>
                        </td>
                        <td class="rover_tbody_td">
                          <%= room_state.resource_states[index] %>
                        </td>
                      </tr>
                    <% end %>
                    </tbody>
                  </table>
              </div>



        <% else %>
          <div class="alert alert-danger" role="alert">
            <strong>Room was not accessed because <%= room_state.no_access_reason %></strong>
          </div>
        <% end %>
      
      
      
      </div>
    </div>
    </div>
      <% end %>
  </div>
  <% end %>
</div>
